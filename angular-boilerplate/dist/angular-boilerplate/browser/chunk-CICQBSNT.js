import{a as H,b as J}from"./chunk-XEH2DIWL.js";import{n as $,r as G}from"./chunk-RNNBFRXI.js";import{a as z,b as B,c as q}from"./chunk-WYIYOJMX.js";import{a as K}from"./chunk-AXGAXXZL.js";import{h as D,j as N}from"./chunk-H52KW6AO.js";import{h as A,k as O,o as V}from"./chunk-P5VQLAOY.js";import{$a as o,Ab as l,Bb as f,Eb as h,Gb as x,Hb as c,Mb as a,Nb as u,Ob as S,Pb as R,Vb as b,Wb as T,Xb as w,Yb as I,Za as g,Zb as L,ba as U,eb as d,ga as P,jb as E,ob as p,qa as v,ra as _,rc as k,sc as F,tc as M,vb as n,vc as j,zb as s}from"./chunk-H7CNO3QB.js";var C=class t{constructor(i){this.apiService=i}follow(i){return this.apiService.post(`/relationships/${i.followed_id}/follow`,i)}unfollow(i){return this.apiService.delete(`/relationships/${i}/unfollow`)}static \u0275fac=function(e){return new(e||t)(P(N))};static \u0275prov=U({token:t,factory:t.\u0275fac,providedIn:"root"})};var Y=t=>["/users",t,"following"],Z=t=>["/users",t,"followers"],ee=(t,i)=>({itemsPerPage:5,currentPage:t,totalItems:i}),te=t=>["/users",t];function ie(t,i){t&1&&(s(0,"div",4)(1,"div",5)(2,"span",6),a(3,"Loading..."),l()()())}function re(t,i){if(t&1&&(s(0,"div",7),a(1),l()),t&2){let e=c();o(),S(" ",e.error," ")}}function oe(t,i){t&1&&f(0,"span",30)}function ne(t,i){if(t&1){let e=h();s(0,"button",28),x("click",function(){v(e);let m=c(3);return _(m.unfollowUser())}),p(1,oe,1,0,"span",29),a(2," Unfollow "),l()}if(t&2){let e=c(3);n("disabled",e.followLoading),o(),n("ngIf",e.followLoading)}}function se(t,i){t&1&&f(0,"span",30)}function le(t,i){if(t&1){let e=h();s(0,"button",31),x("click",function(){v(e);let m=c(3);return _(m.followUser())}),p(1,se,1,0,"span",29),a(2," Follow "),l()}if(t&2){let e=c(3);n("disabled",e.followLoading),o(),n("ngIf",e.followLoading)}}function ae(t,i){if(t&1&&(s(0,"div",25),p(1,ne,3,2,"button",26)(2,le,3,2,"button",27),l()),t&2){let e=c(2);o(),n("ngIf",e.user.current_user_following_user),o(),n("ngIf",!e.user.current_user_following_user)}}function ce(t,i){t&1&&(s(0,"div",32),a(1," No microposts found "),l())}function pe(t,i){if(t&1&&f(0,"img",44),t&2){let e=c().$implicit;n("src",e.image,g)}}function de(t,i){if(t&1&&(s(0,"li",35)(1,"div",36),f(2,"img",37),s(3,"div",38)(4,"div",39)(5,"a",40),a(6),l()(),s(7,"div",41),a(8),l(),p(9,pe,1,1,"img",42),s(10,"div",43),a(11),w(12,"timeAgo"),l()()()()),t&2){let e=i.$implicit;n("id","micropost-"+e.id),o(2),n("src",e.gravatar,g)("alt",e.user_name)("width",50)("height",50),o(3),n("routerLink",b(12,te,e.user_id)),o(),u(e.user_name),o(2),u(e.content),o(),n("ngIf",e.image),o(2),S(" Posted ",I(12,10,e.createdAt)," ago. ")}}function me(t,i){if(t&1&&(s(0,"ul",33),p(1,de,13,14,"li",34),w(2,"paginate"),l()),t&2){let e=c(2);o(),n("ngForOf",L(2,1,e.microposts,T(4,ee,e.page,e.totalCount)))}}function fe(t,i){if(t&1){let e=h();s(0,"div",45)(1,"pagination-controls",46),x("pageChange",function(m){v(e);let y=c(2);return _(y.handlePageChange(m))}),l()()}}function ue(t,i){if(t&1&&(s(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11)(4,"div",12),f(5,"img",13),s(6,"h3",14),a(7),l()(),s(8,"div"),a(9),l()()(),s(10,"div",15)(11,"div",11)(12,"div",16)(13,"a",17)(14,"div",18),a(15),l(),s(16,"div"),a(17,"following"),l()(),s(18,"a",17)(19,"div",18),a(20),l(),s(21,"div"),a(22,"followers"),l()()(),p(23,ae,3,2,"div",19),w(24,"async"),l()()(),s(25,"div",20)(26,"h3",21),a(27,"Microposts"),l(),p(28,ce,2,0,"div",22)(29,me,3,7,"ul",23)(30,fe,2,0,"div",24),l()()),t&2){let e,r=c();o(5),n("src",r.user.gravatar,g)("alt",r.user.name),o(2),u(r.user.name),o(2),R("",r.totalCount," micropost",r.totalCount!==1?"s":"",""),o(4),n("routerLink",b(15,Y,r.user.id)),o(2),u(r.user.following),o(3),n("routerLink",b(17,Z,r.user.id)),o(2),u(r.user.followers),o(3),n("ngIf",((e=I(24,13,r.currentUser$))==null?null:e.id)!==r.user.id),o(5),n("ngIf",r.microposts.length===0),o(),n("ngIf",r.microposts.length>0),o(),n("ngIf",r.totalCount>5)}}var Q=class t{constructor(i,e,r,m,y,ve){this.route=i;this.userService=e;this.micropostService=r;this.relationshipService=m;this.toastr=y;this.store=ve;this.currentUser$=this.store.select(G)}user={};microposts=[];loading=!0;error="";page=1;totalCount=0;followLoading=!1;currentUser$;ngOnInit(){this.route.paramMap.subscribe(i=>{let e=i.get("id");e&&this.fetchUserProfile(e)})}fetchUserProfile(i){this.userService.getUser(i,{page:this.page}).subscribe({next:e=>{this.user=e.user,this.microposts=e.microposts,this.totalCount=e.total_count,this.loading=!1,this.followLoading=!1},error:e=>{console.error(e),this.error="Failed to load user profile",this.loading=!1,this.followLoading=!1}})}handlePageChange(i){this.page=i,this.fetchUserProfile(this.user.id)}followUser(){this.followLoading=!0,this.relationshipService.follow({followed_id:this.user.id}).subscribe({next:i=>{i.follow&&this.fetchUserProfile(this.user.id)},error:i=>{console.error(i),this.toastr.error("Failed to follow user")}})}unfollowUser(){this.followLoading=!0,this.relationshipService.unfollow(this.user.id).subscribe({next:i=>{i.unfollow&&this.fetchUserProfile(this.user.id)},error:i=>{console.error(i),this.toastr.error("Failed to unfollow user")}})}removeMicropost(i,e){i.preventDefault(),confirm("Are you sure?")&&this.micropostService.remove(e).subscribe({next:r=>{r.flash?this.toastr.success(r.flash[1]):this.toastr.success("Micropost deleted successfully"),this.fetchUserProfile(this.user.id)},error:r=>{console.error(r),this.toastr.error("Failed to delete micropost")}})}static \u0275fac=function(e){return new(e||t)(d(A),d(K),d(J),d(C),d(D),d($))};static \u0275cmp=E({type:t,selectors:[["app-user-profile"]],decls:4,vars:3,consts:[[1,"user-profile"],["class","text-center py-4",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row",4,"ngIf"],[1,"text-center","py-4"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"alert","alert-danger"],[1,"row"],[1,"col-md-4"],[1,"card","mb-4"],[1,"card-body"],[1,"d-flex","align-items-center","mb-3"],["width","80","height","80",1,"rounded-circle","me-3",3,"src","alt"],[1,"h4","mb-0"],[1,"card"],[1,"d-flex","justify-content-around"],[1,"text-decoration-none","text-center",3,"routerLink"],[1,"h5","mb-0"],["class","text-center mt-3",4,"ngIf"],[1,"col-md-8"],[1,"mb-4"],["class","alert alert-info",4,"ngIf"],["class","list-group mb-4",4,"ngIf"],["class","d-flex justify-content-center",4,"ngIf"],[1,"text-center","mt-3"],["class","btn btn-outline-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-outline-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"btn","btn-primary",3,"click","disabled"],[1,"alert","alert-info"],[1,"list-group","mb-4"],["class","list-group-item",3,"id",4,"ngFor","ngForOf"],[1,"list-group-item",3,"id"],[1,"d-flex"],[1,"rounded-circle","me-3",3,"src","alt","width","height"],[1,"flex-grow-1"],[1,"mb-1"],[3,"routerLink"],[1,"mb-2"],["alt","Post image","class","img-fluid mb-2",3,"src",4,"ngIf"],[1,"text-muted","small"],["alt","Post image",1,"img-fluid","mb-2",3,"src"],[1,"d-flex","justify-content-center"],[3,"pageChange"]],template:function(e,r){e&1&&(s(0,"div",0),p(1,ie,4,0,"div",1)(2,re,2,1,"div",2)(3,ue,31,19,"div",3),l()),e&2&&(o(),n("ngIf",r.loading),o(),n("ngIf",r.error),o(),n("ngIf",!r.loading&&!r.error))},dependencies:[j,k,F,M,V,O,q,z,B,H],encapsulation:2})};export{Q as UserProfileComponent};
