import './polyfills.server.mjs';
import{b as V,c as W,d as F,e as N,f as O,g as P,h as R,j as A}from"./chunk-526JL7ER.mjs";import{a as j}from"./chunk-5MWZU3IA.mjs";import{i as T}from"./chunk-V7CMVNQF.mjs";import{l as I,o as U}from"./chunk-TCURBYIA.mjs";import{Cb as r,Db as n,Eb as b,Hb as y,Jb as S,Jc as E,Kb as p,Kc as M,Nc as D,Pb as d,Qb as w,Tb as _,Ub as v,Vb as h,_a as C,ab as o,fb as u,kb as x,oa as c,pa as f,pb as g,yb as l}from"./chunk-LQE7B4AG.mjs";import"./chunk-X2SEQXRR.mjs";function B(a,t){a&1&&(r(0,"div",5)(1,"div",6)(2,"span",7),d(3,"Loading..."),n()()())}function q(a,t){if(a&1&&(r(0,"li"),d(1),n()),a&2){let e=t.$implicit;o(),w(e)}}function k(a,t){if(a&1&&(r(0,"div",32)(1,"ul",33),g(2,q,2,1,"li",34),n()()),a&2){let e=p(2);o(2),l("ngForOf",e.errors)}}function z(a,t){a&1&&b(0,"span",35)}function G(a,t){if(a&1){let e=y();r(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11),b(4,"img",12),r(5,"h3",13),d(6),n(),r(7,"p",14)(8,"a",15),d(9,"change"),n()()()()(),r(10,"div",16)(11,"div",17)(12,"div",18)(13,"form",19,0),S("ngSubmit",function(){c(e);let i=p();return f(i.handleSubmit())}),g(15,k,3,1,"div",20),r(16,"div",21)(17,"label",22),d(18,"Name"),n(),r(19,"input",23),h("ngModelChange",function(i){c(e);let s=p();return v(s.formData.name,i)||(s.formData.name=i),f(i)}),n()(),r(20,"div",21)(21,"label",24),d(22,"Email"),n(),r(23,"input",25),h("ngModelChange",function(i){c(e);let s=p();return v(s.formData.email,i)||(s.formData.email=i),f(i)}),n()(),r(24,"div",21)(25,"label",26),d(26,"Password"),n(),r(27,"input",27),h("ngModelChange",function(i){c(e);let s=p();return v(s.formData.password,i)||(s.formData.password=i),f(i)}),n()(),r(28,"div",2)(29,"label",28),d(30,"Confirm Password"),n(),r(31,"input",29),h("ngModelChange",function(i){c(e);let s=p();return v(s.formData.passwordConfirmation,i)||(s.formData.passwordConfirmation=i),f(i)}),n()(),r(32,"button",30),g(33,z,1,0,"span",31),d(34," Save changes "),n()()()()()()}if(a&2){let e=p();o(4),l("src",e.gravatar,C)("alt",e.user.name),o(2),w(e.user.name),o(9),l("ngIf",e.errors.length),o(4),_("ngModel",e.formData.name),o(4),_("ngModel",e.formData.email),o(4),_("ngModel",e.formData.password),o(4),_("ngModel",e.formData.passwordConfirmation),o(),l("disabled",e.submitting),o(),l("ngIf",e.submitting)}}var L=class a{constructor(t,e,m,i){this.route=t;this.router=e;this.userService=m;this.toastr=i}userId="";user={name:"",email:""};gravatar="";loading=!0;submitting=!1;errors=[];formData={name:"",email:"",password:"",passwordConfirmation:""};ngOnInit(){this.route.paramMap.subscribe(t=>{this.userId=t.get("id")||"",this.userId&&this.fetchUserData()})}fetchUserData(){this.loading=!0,this.userService.editUser(this.userId).subscribe({next:t=>{this.user=t.user,this.gravatar=t.gravatar,this.formData.name=t.user.name,this.formData.email=t.user.email,this.loading=!1},error:t=>{console.error(t),this.toastr.error("Failed to fetch user data"),this.router.navigate(["/"]),this.loading=!1}})}handleSubmit(){this.submitting=!0,this.errors=[],this.userService.updateUser(this.userId,{user:{name:this.formData.name,email:this.formData.email,password:this.formData.password,password_confirmation:this.formData.passwordConfirmation}}).subscribe({next:t=>{t.flash_success&&(this.toastr.success(t.flash_success[1]),this.router.navigate([`/users/${this.userId}`])),t.error&&(this.errors=Array.isArray(t.error)?t.error:[t.error]),this.submitting=!1},error:t=>{if(console.error(t),t.error?.errors){let e=t.error.errors,m=[];Object.keys(e).forEach(i=>{e[i].forEach(s=>{m.push(`${i} ${s}`)})}),this.errors=m}else this.toastr.error("Failed to update profile");this.submitting=!1}})}static \u0275fac=function(e){return new(e||a)(u(I),u(U),u(j),u(T))};static \u0275cmp=x({type:a,selectors:[["app-user-edit"]],decls:5,vars:2,consts:[["editForm","ngForm"],[1,"container","py-4"],[1,"mb-4"],["class","text-center py-4",4,"ngIf"],["class","row",4,"ngIf"],[1,"text-center","py-4"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"row"],[1,"col-md-4"],[1,"card","mb-4"],[1,"card-body","text-center"],["width","80","height","80",1,"rounded-circle","mb-3",3,"src","alt"],[1,"h5"],[1,"mt-2"],["href","https://gravatar.com/emails","target","_blank","rel","noopener noreferrer"],[1,"col-md-8"],[1,"card"],[1,"card-body"],[3,"ngSubmit"],["class","alert alert-danger mb-4",4,"ngIf"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"form-label"],["type","email","id","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","password",1,"form-label"],["type","password","id","password","name","password",1,"form-control",3,"ngModelChange","ngModel"],["for","passwordConfirmation",1,"form-label"],["type","password","id","passwordConfirmation","name","passwordConfirmation",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],[1,"alert","alert-danger","mb-4"],[1,"mb-0"],[4,"ngFor","ngForOf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,m){e&1&&(r(0,"div",1)(1,"h1",2),d(2,"Update your profile"),n(),g(3,B,4,0,"div",3)(4,G,35,10,"div",4),n()),e&2&&(o(3),l("ngIf",m.loading),o(),l("ngIf",!m.loading))},dependencies:[D,E,M,A,P,V,W,F,R,O,N],encapsulation:2})};export{L as UserEditComponent};
