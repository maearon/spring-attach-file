import './polyfills.server.mjs';
import{a as me,b as ce}from"./chunk-PMHIEWDB.mjs";import{a as ae,b as le,c as se}from"./chunk-U5NP35D4.mjs";import{n as J,r as K,s as Q}from"./chunk-6QCSGKPO.mjs";import{b as Y,c as ee,d as te,e as ie,f as ne,g as oe,j as re}from"./chunk-526JL7ER.mjs";import{i as X}from"./chunk-V7CMVNQF.mjs";import{p as W,t as q}from"./chunk-TCURBYIA.mjs";import{$b as u,Cb as o,Db as r,Eb as h,Fa as B,Fb as N,Gb as O,Hb as E,Jb as C,Jc as j,Kb as d,Kc as D,Lc as Z,Nc as R,Ob as F,Pb as s,Qb as S,Rb as M,Rc as G,Sb as L,Tb as V,Ub as A,Vb as $,Yb as b,Zb as z,_a as w,_b as f,ab as l,ac as U,bc as T,fb as y,kb as k,oa as v,pa as x,pb as g,qa as H,yb as m}from"./chunk-LQE7B4AG.mjs";import"./chunk-X2SEQXRR.mjs";var P=n=>["/users",n],de=n=>["/users",n,"following"],ge=n=>["/users",n,"followers"],_e=(n,i)=>({itemsPerPage:5,currentPage:n,totalItems:i});function fe(n,i){n&1&&(o(0,"div",5)(1,"div",6)(2,"span",7),s(3,"Loading..."),r()()())}function ue(n,i){if(n&1&&(o(0,"li"),s(1),r()),n&2){let e=i.$implicit;l(),S(e)}}function he(n,i){if(n&1&&(o(0,"div",33)(1,"ul",34),g(2,ue,2,1,"li",35),r()()),n&2){let e=d(3);l(2),m("ngForOf",e.errors)}}function ve(n,i){if(n&1&&h(0,"img",50),n&2){let e=i.$implicit,t=i.index;m("src","http://localhost:8080"+e,w)("alt","Image-"+e+"-"+t)}}function xe(n,i){if(n&1&&(o(0,"div",48),g(1,ve,1,2,"img",49),r()),n&2){let e=d().$implicit;l(),m("ngForOf",e.imageUrls)}}function Ce(n,i){if(n&1){let e=E();o(0,"a",51),C("click",function(a){v(e);let c=d().$implicit,_=d(4);return x(_.removeMicropost(a,c.id))}),s(1," delete "),r()}}function Se(n,i){if(n&1&&(o(0,"li",39)(1,"a",40),h(2,"img",41),r(),o(3,"div",42)(4,"div",43)(5,"a",15),s(6),r()(),o(7,"div",44),s(8),g(9,xe,2,1,"div",45),r(),o(10,"div",46),s(11),f(12,"timeAgo"),g(13,Ce,2,0,"a",47),f(14,"async"),r()()()),n&2){let e,t=i.$implicit,a=d(4);m("id","micropost-"+t.id),l(),m("routerLink",b(16,P,t.user==null?null:t.user.id)),l(),m("src",t.gravatar,w)("alt",t.user==null?null:t.user.name)("width",50)("height",50),l(3),m("routerLink",b(18,P,t.user==null?null:t.user.id)),l(),S(t.user==null?null:t.user.name),l(2),M(" ",t.content," "),l(),m("ngIf",t.imageUrls.length>0),l(2),M(" Posted ",u(12,12,t.createdAt)," ago. "),l(2),m("ngIf",((e=u(14,14,a.user$))==null?null:e.id)===(t.user==null?null:t.user.id))}}function be(n,i){if(n&1){let e=E();o(0,"div")(1,"ol",36),g(2,Se,15,20,"li",37),f(3,"paginate"),r(),o(4,"pagination-controls",38),C("pageChange",function(a){v(e);let c=d(3);return x(c.handlePageChange(a))}),r()()}if(n&2){let e=d(3);l(2),m("ngForOf",U(3,1,e.feedItems,z(4,_e,e.page,e.totalCount)))}}function Ie(n,i){n&1&&(o(0,"div",52),s(1,"No microposts yet."),r())}function ye(n,i){if(n&1){let e=E();o(0,"div",9)(1,"aside",10)(2,"section",11)(3,"div",12),h(4,"img",13),f(5,"async"),o(6,"div")(7,"h1",14),s(8),f(9,"async"),r(),o(10,"a",15),f(11,"async"),s(12,"view my profile"),r()()(),o(13,"div"),s(14),r()(),o(15,"section",16)(16,"div",17)(17,"div",18)(18,"a",15),f(19,"async"),o(20,"strong",19),s(21),r(),s(22," following "),r()(),o(23,"div",18)(24,"a",15),f(25,"async"),o(26,"strong",19),s(27),r(),s(28," followers "),r()()()(),o(29,"section",20)(30,"form",21,1),C("ngSubmit",function(){v(e);let a=d(2);return x(a.handleSubmit())}),g(32,he,3,1,"div",22),o(33,"div",23)(34,"textarea",24),$("ngModelChange",function(a){v(e);let c=d(2);return A(c.content,a)||(c.content=a),x(a)}),r()(),o(35,"div",25)(36,"button",26),s(37," Post "),r(),o(38,"div",27)(39,"input",28),C("change",function(a){v(e);let c=d(2);return x(c.handleImageInput(a))}),r(),o(40,"input",29),C("change",function(a){v(e);let c=d(2);return x(c.handleImagesInput(a))}),r()()()()()(),o(41,"div",30)(42,"h3",31),s(43,"Micropost Feed"),r(),g(44,be,5,7,"div",32)(45,Ie,2,0,"ng-template",null,2,T),r()()}if(n&2){let e,t,a,c,_,I=F(46),p=d(2);l(4),m("src","https://secure.gravatar.com/avatar/"+p.gravatar+"?s=50",w)("alt",(e=u(5,15,p.user$))==null?null:e.name),l(4),S((t=u(9,17,p.user$))==null?null:t.name),l(2),m("routerLink",b(25,P,(a=u(11,19,p.user$))==null?null:a.id)),l(4),L("",p.micropostCount," micropost",p.micropostCount!==1?"s":"",""),l(4),m("routerLink",b(27,de,(c=u(19,21,p.user$))==null?null:c.id)),l(3),S(p.followingCount),l(3),m("routerLink",b(29,ge,(_=u(25,23,p.user$))==null?null:_.id)),l(3),S(p.followersCount),l(5),m("ngIf",p.errors.length),l(2),V("ngModel",p.content),l(2),m("disabled",p.submitting),l(8),m("ngIf",p.feedItems.length>0)("ngIfElse",I)}}function we(n,i){n&1&&(o(0,"div",53)(1,"h1",54),s(2,"Welcome to the Sample App"),r(),o(3,"p",55),s(4," This is the home page for the "),o(5,"a",56),s(6,"Angular Tutorial"),r(),s(7," sample application. "),r(),o(8,"a",57),s(9,"Sign up now!"),r()(),o(10,"div",58)(11,"a",56),H(),o(12,"svg",59)(13,"g",60),h(14,"path",61)(15,"path",62),r(),o(16,"defs",63)(17,"linearGradient",64),h(18,"stop",65)(19,"stop",66)(20,"stop",67)(21,"stop",68)(22,"stop",69)(23,"stop",70),r(),o(24,"linearGradient",71),h(25,"stop",72)(26,"stop",73),r(),o(27,"clipPath",74),h(28,"path",75),r()()()()())}function Ee(n,i){if(n&1&&(N(0),g(1,ye,47,31,"div",8),f(2,"async"),g(3,we,29,0,"ng-template",null,0,T),O()),n&2){let e=F(4),t=d();l(),m("ngIf",u(2,2,t.loggedIn$))("ngIfElse",e)}}var pe=class n{constructor(i,e,t,a){this.store=i;this.micropostService=e;this.toastr=t;this.platformId=a;this.loggedIn$=this.store.select(Q),this.user$=this.store.select(K)}loading=!0;loggedIn$;user$;page=1;feedItems=[];totalCount=0;followingCount=0;followersCount=0;micropostCount=0;gravatar="";content="";image=null;imageName="";images=null;imageNames=[];errors=[];submitting=!1;ngOnInit(){this.checkAuthAndLoadFeed()}checkAuthAndLoadFeed(){G(this.platformId)?localStorage.getItem("token")?this.loadFeed():this.loading=!1:this.loading=!1}loadFeed(){this.micropostService.getAll({page:this.page}).subscribe({next:i=>{this.feedItems=i.feedItems.content,this.totalCount=i.totalElements,this.followingCount=i.following,this.followersCount=i.followers,this.micropostCount=i.micropost,this.gravatar=i.gravatar,this.loading=!1},error:i=>{console.error("Error loading feed:",i),this.loading=!1}})}handlePageChange(i){this.page=i,this.loadFeed()}handleImageInput(i){let e=i.target;if(e.files&&e.files.length>0){let t=e.files[0];t.size/1024/1024>5?(this.toastr.error("Maximum file size is 5MB. Please choose a smaller file."),this.image=null,e.value=""):(this.image=t,this.imageName=t.name)}}handleImagesInput(i){let e=i.target,t=e.files;if(!t)return;let a=[],c=0;for(let _ of Array.from(t)){let I=_.size/1024/1024;if(I>5){this.toastr.error(`File "${_.name}" is too large (${I.toFixed(2)}MB). Max size per file is 5MB.`);continue}if(c+=I,c>50){this.toastr.error("Total file size exceeds 50MB. Please select smaller or fewer files."),e.value="";return}a.push(_)}if(a.length===0){this.toastr.error("No valid files selected."),e.value="";return}this.images=a,this.imageNames=a.map(_=>_.name)}handleSubmit(){if(this.submitting=!0,this.errors=[],this.content.trim().length>0){let i=new FormData;if(i.append("micropost[content]",this.content),this.image&&i.append("micropost[images]",this.image||new Blob,this.imageName),this.images)for(let e=0;e<this.images.length;e++){let t=this.images[e],a=this.imageNames[e];i.append("micropost[images]",t,a)}this.micropostService.create(i).subscribe({next:e=>{e.flash&&(this.toastr.success(e.flash[1]),this.content="",this.image=null,this.imageName="",this.images=null,this.imageNames=[],this.errors=[],this.loadFeed()),e.error&&(this.errors=e.error),this.submitting=!1},error:e=>{this.toastr.error("Failed to create micropost"),this.submitting=!1}})}else this.errors=["Content can't be blank"]}removeMicropost(i,e){i.preventDefault(),confirm("Are you sure?")&&this.micropostService.remove(e).subscribe({next:t=>{t.flash&&(this.toastr.success(t.flash[1]),this.loadFeed())},error:t=>{this.toastr.error("Failed to delete micropost")}})}static \u0275fac=function(e){return new(e||n)(y(J),y(ce),y(X),y(B))};static \u0275cmp=k({type:n,selectors:[["app-home"]],decls:2,vars:2,consts:[["welcomePage",""],["micropostForm","ngForm"],["noMicroposts",""],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"],["class","row",4,"ngIf","ngIfElse"],[1,"row"],[1,"col-md-4"],[1,"user-info","mb-4"],[1,"d-flex","align-items-center","mb-3"],["width","50","height","50",1,"gravatar","rounded-circle","me-3",3,"src","alt"],[1,"h5","mb-1"],[3,"routerLink"],[1,"stats","mb-4"],[1,"d-flex","justify-content-around"],[1,"text-center"],[1,"d-block"],[1,"micropost-form"],[3,"ngSubmit"],["class","alert alert-danger",4,"ngIf"],[1,"form-group","mb-3"],["placeholder","Compose new micropost...","name","content","id","micropost_content","rows","3",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex"],["type","submit",1,"btn","btn-primary","me-2",3,"disabled"],[1,"form-group","flex-grow-1"],["type","file","accept","image/jpeg,image/gif,image/png",1,"form-control",3,"change"],["type","file","accept","image/jpeg,image/gif,image/png","multiple","",1,"form-control",3,"change"],[1,"col-md-8"],[1,"mb-4"],[4,"ngIf","ngIfElse"],[1,"alert","alert-danger"],[1,"mb-0"],[4,"ngFor","ngForOf"],[1,"list-unstyled"],["class","media mb-4 d-flex",3,"id",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center",3,"pageChange"],[1,"media","mb-4","d-flex",3,"id"],[1,"me-3",3,"routerLink"],[1,"gravatar","rounded-circle",3,"src","alt","width","height"],[1,"media-body"],[1,"user","mb-1"],[1,"content","mb-2"],["class","mt-2",4,"ngIf"],[1,"timestamp","text-muted","small"],["href","#","class","ms-2",3,"click",4,"ngIf"],[1,"mt-2"],["class","img-fluid mt-2","width","50","height","50",3,"src","alt",4,"ngFor","ngForOf"],["width","50","height","50",1,"img-fluid","mt-2",3,"src","alt"],["href","#",1,"ms-2",3,"click"],[1,"alert","alert-info"],[1,"text-center","jumbotron","bg-light","p-5","rounded"],[1,"display-4"],[1,"lead"],["href","https://angular.dev/","target","_blank","rel","noopener noreferrer"],["routerLink","/signup",1,"btn","btn-lg","btn-primary"],[1,"text-center","mt-4"],["_ngcontent-ng-c139922363","","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 223 236","width","32",1,"angular-logo"],["_ngcontent-ng-c139922363","","clip-path","url(#a)"],["_ngcontent-ng-c139922363","","fill","url(#b)","d","m222.077 39.192-8.019 125.923L137.387 0l84.69 39.192Zm-53.105 162.825-57.933 33.056-57.934-33.056 11.783-28.556h92.301l11.783 28.556ZM111.039 62.675l30.357 73.803H80.681l30.358-73.803ZM7.937 165.115 0 39.192 84.69 0 7.937 165.115Z"],["_ngcontent-ng-c139922363","","fill","url(#c)","d","m222.077 39.192-8.019 125.923L137.387 0l84.69 39.192Zm-53.105 162.825-57.933 33.056-57.934-33.056 11.783-28.556h92.301l11.783 28.556ZM111.039 62.675l30.357 73.803H80.681l30.358-73.803ZM7.937 165.115 0 39.192 84.69 0 7.937 165.115Z"],["_ngcontent-ng-c139922363",""],["_ngcontent-ng-c139922363","","id","b","x1","49.009","x2","225.829","y1","213.75","y2","129.722","gradientUnits","userSpaceOnUse"],["_ngcontent-ng-c139922363","","stop-color","#E40035"],["_ngcontent-ng-c139922363","","offset",".24","stop-color","#F60A48"],["_ngcontent-ng-c139922363","","offset",".352","stop-color","#F20755"],["_ngcontent-ng-c139922363","","offset",".494","stop-color","#DC087D"],["_ngcontent-ng-c139922363","","offset",".745","stop-color","#9717E7"],["_ngcontent-ng-c139922363","","offset","1","stop-color","#6C00F5"],["_ngcontent-ng-c139922363","","id","c","x1","41.025","x2","156.741","y1","28.344","y2","160.344","gradientUnits","userSpaceOnUse"],["_ngcontent-ng-c139922363","","stop-color","#FF31D9"],["_ngcontent-ng-c139922363","","offset","1","stop-color","#FF5BE1","stop-opacity","0"],["_ngcontent-ng-c139922363","","id","a"],["_ngcontent-ng-c139922363","","fill","#fff","d","M0 0h223v236H0z"]],template:function(e,t){e&1&&g(0,fe,4,0,"div",3)(1,Ee,5,4,"ng-container",4),e&2&&(m("ngIf",t.loading),l(),m("ngIf",!t.loading))},dependencies:[R,j,D,Z,q,W,re,oe,Y,ee,te,ne,ie,se,ae,le,me],styles:[".gravatar[_ngcontent-%COMP%]{border-radius:50%}.user-info[_ngcontent-%COMP%], .stats[_ngcontent-%COMP%]{margin-bottom:1rem}.micropost-form[_ngcontent-%COMP%]{margin-bottom:2rem}.media[_ngcontent-%COMP%]{margin-bottom:1rem}"]})};export{pe as HomeComponent};
